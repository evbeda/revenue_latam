
{% extends 'revenue_app/base.html' %}
{% load static %}
{% load glossary_filters %}
{% load humanize %}

{% block content %}
<h1>Dashboard</h1>
<br>
<div class="row m-0">
  {% for currency, data in summarized_data.items %}
  <div class="col-xl-6">
    <div class="row">
      <h4>{{currency}}</h4>
      <table class="table table-striped mt-4">
        {% for parent_key, parent_value in data.items %}
        <tr>
          <td class="align-middle" rowspan="{{ parent_value|length }}"><b>{{parent_key}}</b></td>
          {% for child_key, child_value in parent_value.items %}
            {% if not forloop.first %}
              <tr>
            {% endif %}
            <td><b data-toggle="tooltip" data-placement="top" title="{% glossary parent_key|add:child_key %}">{{child_key}}</b></td>
            <td class="text-right text-monospace">{{child_value|floatformat:2|intcomma}}</td>
            {% if not forloop.first %}
              </tr>
            {% endif %}
          {% endfor %}
        </tr>
        {% endfor %}
      </table>
    </div>
    <br>
    <h4>{{currency}} Payment Processor</h4>
    <h6>Referred to GTV</h6>
    <div class="row">
      <div class="dashboard-chart-container">
        <div class="card--chart">
          <div class="js-donut-chart-container-{{currency|lower}}_pp_gtv donut-chart-container"></div>
          <div class="js-legend-chart-container-{{currency|lower}}_pp_gtv legend-chart-container"></div>
        </div>
      </div>
    </div>
    <h4>{{currency}} Payment Processor</h4>
    <h6>Referred to GTF</h6>
    <div class="row">
      <div class="dashboard-chart-container">
        <div class="card--chart">
          <div class="js-donut-chart-container-{{currency|lower}}_pp_gtf donut-chart-container"></div>
          <div class="js-legend-chart-container-{{currency|lower}}_pp_gtf legend-chart-container"></div>
        </div>
      </div>
    </div>
    <h4>{{currency}} Sales Flag</h4>
    <h6>Referred to organizers quantity</h6>
    <div class="row">
      <div class="dashboard-chart-container">
        <div class="card--chart">
          <div class="js-donut-chart-container-{{currency|lower}}_sf_org donut-chart-container"></div>
          <div class="js-legend-chart-container-{{currency|lower}}_sf_org legend-chart-container"></div>
        </div>
      </div>
    </div>
    <h4>{{currency}} Sales Flag</h4>
    <h6>Referred to GTF</h6>
    <div class="row">
      <div class="dashboard-chart-container">
        <div class="card--chart">
          <div class="js-donut-chart-container-{{currency|lower}}_sf_gtf donut-chart-container"></div>
          <div class="js-legend-chart-container-{{currency|lower}}_sf_gtf legend-chart-container"></div>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock content %}
{% block scripts %}
  {{ block.super }}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.7.4/d3.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/britecharts@2/dist/bundled/britecharts.min.js"></script>
  <script type="text/javascript" src="{% static 'revenue_app/js/donut_chart.js' %}"></script>
  <script type="text/javascript">
    fetch('{% url "json_dashboard_summary" %}')
      .then(res => res.json())
      .then(json => {
        let arsPPGtv = json['ars_pp_gtv'];
        let arsPPGtf = json['ars_pp_gtv'];
        let brlPPGtv = json['brl_pp_gtv'];
        let brlPPGtf = json['brl_pp_gtf'];
        let arsSFOrg = json['ars_sf_org'];
        let arsSFGtf = json['ars_sf_gtf'];
        let brlSFOrg = json['brl_sf_org'];
        let brlSFGtf = json['brl_sf_gtf'];
        let legendHeight = 150;
        createDonutChart(arsPPGtv, 'ars_pp_gtv', legendHeight);
        createDonutChart(arsPPGtf, 'ars_pp_gtf', legendHeight);
        createDonutChart(brlPPGtv, 'brl_pp_gtv', legendHeight);
        createDonutChart(brlPPGtf, 'brl_pp_gtf', legendHeight);
        createDonutChart(arsSFOrg, 'ars_sf_org', legendHeight);
        createDonutChart(arsSFGtf, 'ars_sf_gtf', legendHeight);
        createDonutChart(brlSFOrg, 'brl_sf_org', legendHeight);
        createDonutChart(brlSFGtf, 'brl_sf_gtf', legendHeight);
      });
  </script>
{% endblock scripts %}
