<html>
    <head>
	{% load static %}
	{% block layout_style %}
	<style type="text/css">
	@page {
	    size: A4 landscape;
	    margin: 1cm;
	}
	.page-break{
	    page-break-after: always;
	}
	</style>
	{% endblock %}
    </head>
{% block content %}
<h1 class="text-center"> Top 10 Argentina Events </h1>

<div class="row">
    <div class="col-12">
        {% include 'revenue_app/_dynamic_table_pdf.html' with transactions=top_event_ars %}
    </div>
</div>
<div class="row">
    <div class="col"></div>
	<div class="col-7 chart-container">
		<canvas id="chart_arg"></canvas>
	</div>
    <div class="col"></div>
</div>
<br>
<hr class="mb-4 mt-4">
<br>
<h1 class="text-center">Top 10 Brazil Events</h1>
<br>
<div class="row">
    <div class="col-12">
        {% include 'revenue_app/_dynamic_table_pdf.html' with transactions=top_event_brl %}
    </div>
</div>
<div class="row">
    <div class="col"></div>
	<div class="col-lg-7 chart-container">
		<canvas id="chart_brl"></canvas>
	</div>
    <div class="col"></div>
</div>
{% endblock content %}

{% block scripts %}
<script type="text/javascript" src="{% static 'js/Chart.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/chartjs-plugin-datalabels.min.js' %}"></script>
<script type="text/javascript">
  Chart.plugins.unregister(ChartDataLabels);

  $.get('{% url "json_top_events" %}', function(data) {
    var ctx_ars = $("#chart_arg").get(0).getContext("2d");
    new Chart(ctx_ars, {
      type: 'doughnut',
      data: {
        labels: data.arg.labels,
        datasets: [{
          label: "Top Argentina Events",
          data: data.arg.data,
          fill: false,
          backgroundColor: data.arg.backgroundColor,
          borderColor: data.arg.borderColor,
          borderWidth: 1,
        }]
      },
      plugins: [ChartDataLabels],
      options: {
        legend: { position: 'right', align: 'center' },
        plugins: {
          datalabels: {
            formatter: (value, ctx) => {
              let sum = 0;
              let dataArr = ctx.chart.data.datasets[0].data;
              dataArr.map(data => { sum += data; });
              let percentage = (value*100/sum).toFixed(2) + "%";
              return percentage;
            }
          }
        },
        responsive: true,
        maintainAspectRatio: false,
      },
    });

    var ctx_brl = $("#chart_brl").get(0).getContext("2d");
    new Chart(ctx_brl, {
      type: 'doughnut',
      data: {
        labels: data.brl.labels,
        datasets: [{
          label: "Top Brazil Organizers",
          data: data.brl.data,
          fill: false,
          backgroundColor: data.brl.backgroundColor,
          borderColor: data.brl.borderColor,
          borderWidth: 1,
        }]
      },
      plugins: [ChartDataLabels],
      options: {
        legend: { position: 'right', align: 'center' },
        plugins: {
          datalabels: {
            formatter: (value, ctx) => {
              let sum = 0;
              let dataArr = ctx.chart.data.datasets[0].data;
              dataArr.map(data => { sum += data; });
              let percentage = (value*100/sum).toFixed(2) + "%";
              return percentage;
            }
          }
        },
        responsive: true,
        maintainAspectRatio: false,
      },
    });
  });
</script>
{% endblock scripts %}
</html>
